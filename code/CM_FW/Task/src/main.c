/*
 ***********************************************************************************************************************
 *                  Copyright(c) 北京康吉森技术有限公司 2015
 *           Beijing Consen Technologies Co.,Ltd. All rights reserved.
 *
 *
 *  项目名称    : 安全控制系统
 * 
 *  模块名称    : 任务层模块
 *
 *  文件名称    : main.c
 *
 *  功能简介    : 创建主任务和校时任务
 *
 *  作者       : 李琦
 *
 *  创建日期    : 2015-12-30
 *
 *  版本信息    : V1.0
 *
 *  修订信息    : 无
 *
 ***********************************************************************************************************************
 */

/*
 ***********************************************************************************************************************
 *                                包含头文件
 ***********************************************************************************************************************
 */
#define __USE_GNU
#define _GNU_SOURCE
#include <sched.h>
#include <ctype.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <sys/wait.h>
#include <pthread.h>
#include <string.h>
#include <errno.h>
#include <ctype.h>
#include <sched.h>
#include <unistd.h>
#include <sys/time.h>
#include <sys/resource.h>
#include "../inc/main.h"

/*
 ***********************************************************************************************************************
 *                                全局变量声明
 ***********************************************************************************************************************
 */
pid_t MainID = -1;

/*
 ***********************************************************************************************************************
 *                                局部变量声明
 ***********************************************************************************************************************
 */

/*
 ***********************************************************************************************************************
 *                                局部函数声明
 ***********************************************************************************************************************
 */

/*
 ***********************************************************************************************************************
 *                                全局函数实现
 ***********************************************************************************************************************
 */
/*
 ***********************************************************************************************************************
 * 函数名称: main
 *
 * 功能描述: main函数
 *
 * 输入参数: 无
 *
 * 输出参数: 无
 *
 * 返 回 值: 无
 *
 * 注意事项: 无
 ***********************************************************************************************************************
 */
int main(void) 
{
    struct sched_param stParam;
    cpu_set_t mask;

    MainID = fork();
    if (-1 == MainID) 
    {
        printf("Main task fork error.\n");
        exit(1);
    }
    else if (0 == MainID) 
    {
        /* Bind to CPU1 */
        CPU_ZERO( &mask );
        CPU_SET( 1, &mask ); /* CPU 1 */
        if( -1 == sched_setaffinity( 0, sizeof(mask), &mask))
        {
            printf( "Bind RTS to CPU1 failed: %d!\n", errno );
        }

        /* Set scheduler */
        stParam.sched_priority = (PRIORITY_RTS);
        if( -1 == sched_setscheduler( 0, (int32_t)(POLICY_RTS), &stParam ))
        {
            printf( "Set RTS scheduler failed: %d!\n", errno );
        }
        
        printf( "Main task start to run.\n" );
        TskMainTask();
    }

    return 0;
}

/*
 ***********************************************************************************************************************
 *                                局部函数实现
 ***********************************************************************************************************************
 */


/*
 ***********************************************************************************************************************
 文件结束
 ***********************************************************************************************************************
 */
